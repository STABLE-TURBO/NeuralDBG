name: Repository Hygiene

on:
  pull_request:
    branches: [main, develop]
  push:
    branches: [main, develop]

jobs:
  check-redundant-files:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check for implementation summary files
        run: |
          if find . -type f \( \
            -name "*IMPLEMENTATION_SUMMARY.md" -o \
            -name "*IMPLEMENTATION_COMPLETE.md" -o \
            -name "*IMPLEMENTATION_CHECKLIST.md" -o \
            -name "*IMPLEMENTATION.md" \
          \) | grep -v ".git" | grep -q .; then
            echo "❌ Found redundant IMPLEMENTATION files:"
            find . -type f \( \
              -name "*IMPLEMENTATION_SUMMARY.md" -o \
              -name "*IMPLEMENTATION_COMPLETE.md" -o \
              -name "*IMPLEMENTATION_CHECKLIST.md" -o \
              -name "*IMPLEMENTATION.md" \
            \) | grep -v ".git"
            echo ""
            echo "These files create repository clutter. Please remove them."
            echo "See scripts/CLEANUP_README.md for details."
            exit 1
          fi
          echo "✅ No redundant IMPLEMENTATION files found"
      
      - name: Check for quick reference duplicates
        run: |
          if find . -type f \( \
            -name "*QUICK_REFERENCE.md" -o \
            -name "*QUICK_REF.md" -o \
            -name "*QUICK_START.md" \
          \) | grep -v ".git" | grep -q .; then
            echo "❌ Found redundant QUICK_REFERENCE files:"
            find . -type f \( \
              -name "*QUICK_REFERENCE.md" -o \
              -name "*QUICK_REF.md" -o \
              -name "*QUICK_START.md" \
            \) | grep -v ".git"
            echo ""
            echo "These files create repository clutter. Please remove them."
            echo "See scripts/CLEANUP_README.md for details."
            exit 1
          fi
          echo "✅ No redundant QUICK_REFERENCE files found"
      
      - name: Check for summary files
        run: |
          if find . -type f \( \
            -name "*_SUMMARY.md" -o \
            -name "PROJECT_SUMMARY.md" -o \
            -name "REFACTORING_SUMMARY.md" -o \
            -name "PACKAGING_SUMMARY.md" \
          \) | grep -v ".git" | grep -v "CLEANUP_README.md" | grep -q .; then
            echo "❌ Found redundant SUMMARY files:"
            find . -type f \( \
              -name "*_SUMMARY.md" -o \
              -name "PROJECT_SUMMARY.md" -o \
              -name "REFACTORING_SUMMARY.md" -o \
              -name "PACKAGING_SUMMARY.md" \
            \) | grep -v ".git" | grep -v "CLEANUP_README.md"
            echo ""
            echo "These files create repository clutter. Please remove them."
            echo "See scripts/CLEANUP_README.md for details."
            exit 1
          fi
          echo "✅ No redundant SUMMARY files found"
      
      - name: Check for temporary scripts
        run: |
          if find . -maxdepth 1 -type f \( \
            -name "repro_*.py" -o \
            -name "reproduce_*.py" -o \
            -name "fix_*.py" -o \
            -name "skip_*.py" -o \
            -name "temp_*.py" -o \
            -name "_temp_*.py" \
          \) | grep -q .; then
            echo "❌ Found temporary scripts in root:"
            find . -maxdepth 1 -type f \( \
              -name "repro_*.py" -o \
              -name "reproduce_*.py" -o \
              -name "fix_*.py" -o \
              -name "skip_*.py" -o \
              -name "temp_*.py" -o \
              -name "_temp_*.py" \
            \)
            echo ""
            echo "Temporary scripts should be removed after use."
            echo "See scripts/CLEANUP_README.md for details."
            exit 1
          fi
          echo "✅ No temporary scripts found in root"
      
      - name: Check for Python cache files
        run: |
          if find . -name "__pycache__" -o -name "*.pyc" -o -name "*.pyo" | grep -v ".git" | grep -v ".venv" | grep -q .; then
            echo "❌ Found Python cache files that should be gitignored:"
            find . -name "__pycache__" -o -name "*.pyc" -o -name "*.pyo" | grep -v ".git" | grep -v ".venv" | head -20
            echo ""
            echo "Python cache files should not be committed."
            echo "Run: git rm -r --cached __pycache__ '*.pyc' '*.pyo'"
            exit 1
          fi
          echo "✅ No Python cache files found"
      
      - name: Check for duplicate venvs
        run: |
          if find . -maxdepth 1 -type d \( \
            -name ".venv[0-9]*" -o \
            -name "venv[0-9]*" \
          \) | grep -q .; then
            echo "❌ Found duplicate virtual environments:"
            find . -maxdepth 1 -type d \( \
              -name ".venv[0-9]*" -o \
              -name "venv[0-9]*" \
            \)
            echo ""
            echo "Only .venv or venv should be used."
            echo "Remove duplicate venvs and update .gitignore"
            exit 1
          fi
          echo "✅ No duplicate virtual environments found"
      
      - name: Summary
        if: success()
        run: |
          echo ""
          echo "================================================"
          echo "✅ Repository hygiene check passed!"
          echo "================================================"
          echo ""
          echo "All checks passed. Repository is clean."
